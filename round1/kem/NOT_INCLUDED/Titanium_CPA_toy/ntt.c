/* ****************************** *
 * Titanium_CPA_toy               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>

/* 512=2*256 */
#define N1_512 2
#define N2_512 256

/* 1024=4*256 */
#define N1_1024 4
#define N2_1024 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* multiplication inverses of 512, 1024, 1280 */
#define INV_512 240171
#define INV_1024 240406
#define INV_1280 240453

/* omega_n: n-th root of unity mod Q */
static const uint32_t w_4[3][3]={{11875,240640,228766},
{240640,1,240640},
{228766,240640,11875}};

static const uint32_t w_5[4][4]={{33290,72295,49909,85146},
{72295,85146,33290,49909},
{49909,33290,85146,72295},
{85146,49909,72295,33290}};

/* omega_256,512,1024,1280, respectively */
static const uint32_t omega_256[128]={1,76283,156068,103051,19886,203515,21271,214071,79833,239593,188869,76616,50361,95239,164847,87605,171645,78084,135740,112831,80526,162692,55543,20582,114822,115508,226549,203952,148484,73743,113253,26058,87754,227685,230680,89315,188153,83495,203738,187510,124290,199311,101992,91565,7229,141276,90564,171784,93217,171502,239101,197629,55639,124520,177608,142123,210477,8830,24731,170074,76709,166091,171103,122950,11875,87901,131159,71140,77429,223703,160716,202242,131976,68332,45255,192020,43990,191066,184231,18332,55105,57727,99082,219678,179557,101552,216785,160635,39344,3800,143636,118976,70893,5526,177467,215065,103220,157740,108497,110738,205831,62205,224777,30077,92497,113890,8847,118337,176179,144089,22871,21243,3275,41467,1216,113343,153580,176696,117276,95292,116949,177415,98605,169478,93190,36989,116162,62303};
static const uint32_t omega_512[512]={1,56644,76283,24456,156068,128016,103051,232748,19886,222704,203515,237196,21271,225678,214071,178375,79833,175421,239593,75415,188869,118699,76616,116910,50361,90070,95239,27978,164847,745,87605,39559,171645,41057,78084,8516,135740,135969,112831,14845,80526,205230,162692,178553,55543,37258,20582,181804,114822,173061,115508,47003,226549,219590,203952,204601,148484,84105,73743,52014,113253,95154,26058,178099,87754,57080,227685,75386,230680,72261,89315,163117,188153,229924,83495,173207,203738,114835,187510,144623,124290,89664,199311,99769,101992,166361,91565,72387,7229,149135,141276,161930,90564,163019,171784,214061,93217,38926,171502,122759,239101,120923,197629,118397,55639,180980,124520,123170,177608,189906,142123,11198,210477,182125,8830,114522,24731,91503,170074,90503,76709,90700,166091,198709,171103,142057,122950,229260,11875,55905,87901,201954,131159,60803,71140,120615,77429,206051,223703,240236,160716,148074,202242,81043,131976,135879,68332,127964,45255,116288,192020,48321,43990,172646,191066,154170,184231,183799,18332,31893,55105,13209,57727,58280,99082,171406,219678,135163,179557,134843,101552,29024,216785,140592,160635,132089,39344,25235,3800,114146,143636,45374,118976,125339,70893,86725,5526,181444,177467,144255,215065,172517,103220,179944,157740,24230,108497,214210,110738,94966,205831,34714,62205,74498,224777,193719,30077,183949,92497,164216,113890,81232,8847,114906,118337,25973,176179,101006,144089,197160,22871,134421,21243,83492,3275,215530,41467,200588,1216,55778,113343,139653,153580,213370,176696,27752,117276,86939,95292,142418,116949,93708,177415,86459,98605,104010,169478,20419,93190,194025,36989,184370,116162,33465,62303,90867,240640,183997,164358,216185,84573,112625,137590,7893,220755,17937,37126,3445,219370,14963,26570,62266,160808,65220,1048,165226,51772,121942,164025,123731,190280,150571,145402,212663,75794,239896,153036,201082,68996,199584,162557,232125,104901,104672,127810,225796,160115,35411,77949,62088,185098,203383,220059,58837,125819,67580,125133,193638,14092,21051,36689,36040,92157,156536,166898,188627,127388,145487,214583,62542,152887,183561,12956,165255,9961,168380,151326,77524,52488,10717,157146,67434,36903,125806,53131,96018,116351,150977,41330,140872,138649,74280,149076,168254,233412,91506,99365,78711,150077,77622,68857,26580,147424,201715,69139,117882,1540,119718,43012,122244,185002,59661,116121,117471,63033,50735,98518,229443,30164,58516,231811,126119,215910,149138,70567,150138,163932,149941,74550,41932,69538,98584,117691,11381,228766,184736,152740,38687,109482,179838,169501,120026,163212,34590,16938,405,79925,92567,38399,159598,108665,104762,172309,112677,195386,124353,48621,192320,196651,67995,49575,86471,56410,56842,222309,208748,185536,227432,182914,182361,141559,69235,20963,105478,61084,105798,139089,211617,23856,100049,80006,108552,201297,215406,236841,126495,97005,195267,121665,115302,169748,153916,235115,59197,63174,96386,25576,68124,137421,60697,82901,216411,132144,26431,129903,145675,34810,205927,178436,166143,15864,46922,210564,56692,148144,76425,126751,159409,231794,125735,122304,214668,64462,139635,96552,43481,217770,106220,219398,157149,237366,25111,199174,40053,239425,184863,127298,100988,87061,27271,63945,212889,123365,153702,145349,98223,123692,146933,63226,154182,142036,136631,71163,220222,147451,46616,203652,56271,124479,207176,178338,149774};
static const uint32_t omega_1024[1024]={1,238,56644,5376,76283,107279,24456,45144,156068,85470,128016,147042,103051,221397,232748,46594,19886,160689,222704,62532,203515,67729,237196,142654,21271,9037,225678,48421,214071,173647,178375,100434,79833,230256,175421,119305,239593,231858,75415,141336,188869,191596,118699,95365,76616,186533,116910,150865,50361,194509,90070,19611,95239,46628,27978,161457,164847,9103,745,177310,87605,154864,39559,30043,171645,183181,41057,145926,78084,54635,8516,101680,135740,60226,135969,114728,112831,142627,14845,164136,80526,154549,205230,235258,162692,218136,178553,142798,55543,224620,37258,204328,20582,85696,181804,194613,114822,135203,173061,38907,115508,57830,47003,117228,226549,15078,219590,43323,203952,171735,204601,85556,148484,205606,84105,43787,73743,224682,52014,106641,113253,2422,95154,26398,26058,185779,178099,34746,87754,190326,57080,109144,227685,44805,75386,134434,230680,35692,72261,112607,89315,80562,163117,78645,188153,21188,229924,96405,83495,139248,173207,73655,203738,120803,114835,138297,187510,108795,144623,8611,124290,222818,89664,163624,199311,29741,99769,162204,101992,209996,166361,128794,91565,134780,72387,142595,7229,36015,149135,119903,141276,174589,161930,36780,90564,137183,163019,55321,171784,216263,214061,171267,93217,46674,38926,120030,171502,149147,122759,99081,239101,114762,120923,143395,197629,110707,118397,23489,55639,6827,180980,239142,124520,36917,123170,196899,177608,158529,189906,197761,142123,135534,11198,18073,210477,40198,182125,30370,8830,176412,114522,63803,24731,110594,91503,120024,170074,49924,90503,122665,76709,208667,90700,169551,166091,64534,198709,127106,171103,54185,142057,119826,122950,144539,229260,179014,11875,179199,55905,70135,87901,225312,201954,177493,131159,173153,60803,32654,71140,86450,120615,70091,77429,139386,206051,190015,223703,59653,240236,144251,160716,229130,148074,108026,202242,5396,81043,36954,131976,126958,135879,93308,68332,140069,127964,134666,45255,182486,116288,2829,192020,219611,48321,190271,43990,122057,172646,180778,191066,233200,154170,115028,184231,50316,183799,188141,18332,31478,31893,130663,55105,120376,13209,15409,57727,22489,58280,154103,99082,239339,171406,126299,219678,64267,135163,163541,179557,141109,134843,87381,101552,105276,29024,169764,216785,97656,140592,11797,160635,209852,132089,153852,39344,219514,25235,230546,3800,182477,114146,214956,143636,14346,45374,210808,118976,161291,125339,231839,70893,27664,86725,186065,5526,111983,181444,108933,177467,124971,144255,161668,215065,169578,172517,150076,103220,20978,179944,233215,157740,2124,24230,231997,108497,73699,214210,206729,110738,125775,94966,222295,205831,137655,34714,80138,62205,125689,74498,163731,224777,74624,193719,142691,30077,179737,183949,223841,92497,115955,164216,99566,113890,154028,81232,81936,8847,180458,114906,155195,118337,9209,25973,165549,176179,59068,101006,215969,144089,122160,197160,239726,22871,149196,134421,227586,21243,2373,83492,138534,3275,57527,215530,39607,41467,2865,200588,93026,1216,48767,55778,39909,113343,23842,139653,28956,153580,215249,213370,6809,176696,182114,27752,107669,117276,237973,86939,236997,95292,59242,142418,205744,116949,160147,93708,163532,177415,112595,86459,122757,98605,125813,104010,208998,169478,148717,20419,46902,93190,40248,194025,215519,36989,140306,184370,83398,116162,213482,33465,23517,62303,149013,90867,209297,240640,240403,183997,235265,164358,133362,216185,195497,84573,155171,112625,93599,137590,19244,7893,194047,220755,79952,17937,178109,37126,172912,3445,97987,219370,231604,14963,192220,26570,66994,62266,140207,160808,10385,65220,121336,1048,8783,165226,99305,51772,49045,121942,145276,164025,54108,123731,89776,190280,46132,150571,221030,145402,194013,212663,79184,75794,231538,239896,63331,153036,85777,201082,210598,68996,57460,199584,94715,162557,186006,232125,138961,104901,180415,104672,125913,127810,98014,225796,76505,160115,86092,35411,5383,77949,22505,62088,97843,185098,16021,203383,36313,220059,154945,58837,46028,125819,105438,67580,201734,125133,182811,193638,123413,14092,225563,21051,197318,36689,68906,36040,155085,92157,35035,156536,196854,166898,15959,188627,134000,127388,238219,145487,214243,214583,54862,62542,205895,152887,50315,183561,131497,12956,195836,165255,106207,9961,204949,168380,128034,151326,160079,77524,161996,52488,219453,10717,144236,157146,101393,67434,166986,36903,119838,125806,102344,53131,131846,96018,232030,116351,17823,150977,77017,41330,210900,140872,78437,138649,30645,74280,111847,149076,105861,168254,98046,233412,204626,91506,120738,99365,66052,78711,203861,150077,103458,77622,185320,68857,24378,26580,69374,147424,193967,201715,120611,69139,91494,117882,141560,1540,125879,119718,97246,43012,129934,122244,217152,185002,233814,59661,1499,116121,203724,117471,43742,63033,82112,50735,42880,98518,105107,229443,222568,30164,200443,58516,210271,231811,64229,126119,176838,215910,130047,149138,120617,70567,190717,150138,117976,163932,31974,149941,71090,74550,176107,41932,113535,69538,186456,98584,120815,117691,96102,11381,61627,228766,61442,184736,170506,152740,15329,38687,63148,109482,67488,179838,207987,169501,154191,120026,170550,163212,101255,34590,50626,16938,180988,405,96390,79925,11511,92567,132615,38399,235245,159598,203687,108665,113683,104762,147333,172309,100572,112677,105975,195386,58155,124353,237812,48621,21030,192320,50370,196651,118584,67995,59863,49575,7441,86471,125613,56410,190325,56842,52500,222309,209163,208748,109978,185536,120265,227432,225232,182914,218152,182361,86538,141559,1302,69235,114342,20963,176374,105478,77100,61084,99532,105798,153260,139089,135365,211617,70877,23856,142985,100049,228844,80006,30789,108552,86789,201297,21127,215406,10095,236841,58164,126495,25685,97005,226295,195267,29833,121665,79350,115302,8802,169748,212977,153916,54576,235115,128658,59197,131708,63174,115670,96386,78973,25576,71063,68124,90565,137421,219663,60697,7426,82901,238517,216411,8644,132144,166942,26431,33912,129903,114866,145675,18346,34810,102986,205927,160503,178436,114952,166143,76910,15864,166017,46922,97950,210564,60904,56692,16800,148144,124686,76425,141075,126751,86613,159409,158705,231794,60183,125735,85446,122304,231432,214668,75092,64462,181573,139635,24672,96552,118481,43481,915,217770,91445,106220,13055,219398,238268,157149,102107,237366,183114,25111,201034,199174,237776,40053,147615,239425,191874,184863,200732,127298,216799,100988,211685,87061,25392,27271,233832,63945,58527,212889,132972,123365,2668,153702,3644,145349,181399,98223,34897,123692,80494,146933,77109,63226,128046,154182,117884,142036,114828,136631,31643,71163,91924,220222,193739,147451,200393,46616,25122,203652,100335,56271,157243,124479,27159,207176,217124,178338,91628,149774,31344};
static const uint32_t omega_1280[1280]={1,35772,147787,235076,179568,76283,167177,86153,216470,218742,156068,233937,103589,195590,8405,103051,201534,151170,209329,90991,19886,27196,184390,29270,17449,203515,26407,115279,136212,76696,21271,240011,83894,22257,136976,214071,69910,79248,108476,67347,79833,99329,132623,193282,227133,239593,50940,92028,56736,234639,188869,225793,192672,63903,89257,76616,47203,208460,47812,95277,50361,75166,156259,87800,175909,95239,134871,234644,127088,2164,164847,239820,230031,190578,237327,87605,178958,153694,16841,111829,171645,129825,209882,140345,168798,78084,100761,101594,60186,199206,135740,37182,51697,219640,33430,112831,159680,218184,168495,68013,80526,103302,35948,186993,15719,162692,156280,117089,151103,219015,55543,152100,28190,126890,138538,20582,138485,49794,6286,104098,114822,151996,158158,158066,236016,115508,146206,230179,190732,211472,226549,43871,133451,213655,108500,203952,17106,206410,110717,98946,148484,141496,192759,47734,192753,73743,27954,107133,153751,130717,113253,95081,17638,226475,43794,26058,144183,55723,93753,159340,87754,214884,34985,150220,156310,227685,12534,52065,148481,34180,230680,64429,135331,85535,7705,89315,226264,196414,126331,115193,188153,120987,18579,198187,20863,83495,187689,127008,28096,133296,203738,62410,103963,98422,173954,187510,221127,44733,166867,66319,124290,18764,78059,169025,16534,199311,41544,153793,189295,63641,101992,99623,61387,86639,34869,91565,98529,151302,118413,106954,7229,147354,146824,198303,79518,141276,23431,21129,213848,33907,90564,146266,210730,154235,118213,171784,48672,57149,88733,102086,93217,236828,44811,69391,42937,171502,67890,12108,214217,239161,239101,17909,54406,147665,202430,197629,33290,158212,164626,34720,55639,217238,17923,73932,50914,124520,64530,138688,92280,167563,177608,230335,236421,164708,80332,142123,1549,63398,72472,42891,210477,7636,27457,135883,99117,8830,145768,203708,192455,1891,24731,81016,64789,18637,107194,170074,1366,14429,219884,98722,76709,5025,236114,11549,190872,166091,221603,227335,5666,64430,171103,233322,2140,28242,61906,122950,212484,91022,166254,36414,11875,61135,216453,91900,50099,87901,179266,101984,54088,82296,131159,42171,203224,204959,184001,71140,41505,202531,200986,40035,77429,12278,38791,95646,14974,223703,27902,172117,169339,179456,160716,219262,228151,78057,97481,202242,210441,163690,1227,95582,131976,150334,143421,230533,100047,68332,181667,81719,185841,196627,45255,69853,206013,107052,143911,192020,82736,229174,95381,161034,43990,58781,233515,168188,155495,191066,127270,15361,110289,189554,184231,116906,102134,125786,111374,18332,25579,94906,14204,112337,55105,125629,29913,157950,177361,57727,69823,95417,4980,70220,99082,200656,26684,157842,164241,219678,189561,193994,188851,63179,179557,164073,226007,147368,166350,101552,1608,8177,128829,195838,216785,176795,24619,165449,116874,160635,209422,48813,47540,231574,39344,145000,163886,33950,184914,3800,212076,175147,29408,141165,143636,221001,109640,75062,45586,118976,32746,190165,142592,174388,70893,109538,35933,131695,205324,5526,109811,176049,49858,129925,177467,239944,93580,227450,28549,215065,12410,188516,111609,2317,103220,230977,100509,231408,117217,157740,125112,65146,35268,166774,108497,96636,55027,223105,53295,110738,128235,123678,24631,113431,205831,93855,198469,1645,128536,62205,230574,122853,111574,194143,224777,185111,72295,208554,41406,30077,8533,109688,107631,160773,92497,229575,1493,225935,218835,113890,20950,67326,50544,124135,8847,31969,69036,97850,166855,118337,35333,85544,89012,216193,176179,128039,90955,175940,966,144089,62129,158953,201168,53232,22871,202653,233632,21974,120422,21243,200959,36755,178077,162533,3275,201774,73374,63341,199237,41467,46400,119823,10864,232434,1216,183372,190806,211549,93301,113343,186228,83213,206907,81967,153580,29730,108981,84132,113558,176696,92806,213637,186527,190837,117276,102519,181469,218093,41576,95292,105659,126202,72784,134269,116949,196484,223961,112720,39244,177415,64287,109168,35548,76012,98605,222923,40098,165296,178501,169478,98303,7983,167650,161439,93190,233548,145459,219646,7421,36989,126290,92387,144911,108511,116162,198917,145195,160837,216136,62303,126615,167519,47486,225014,240640,204869,92854,5565,61073,164358,73464,154488,24171,21899,84573,6704,137052,45051,232236,137590,39107,89471,31312,149650,220755,213445,56251,211371,223192,37126,214234,125362,104429,163945,219370,630,156747,218384,103665,26570,170731,161393,132165,173294,160808,141312,108018,47359,13508,1048,189701,148613,183905,6002,51772,14848,47969,176738,151384,164025,193438,32181,192829,145364,190280,165475,84382,152841,64732,145402,105770,5997,113553,238477,75794,821,10610,50063,3314,153036,61683,86947,223800,128812,68996,110816,30759,100296,71843,162557,139880,139047,180455,41435,104901,203459,188944,21001,207211,127810,80961,22457,72146,172628,160115,137339,204693,53648,224922,77949,84361,123552,89538,21626,185098,88541,212451,113751,102103,220059,102156,190847,234355,136543,125819,88645,82483,82575,4625,125133,94435,10462,49909,29169,14092,196770,107190,26986,132141,36689,223535,34231,129924,141695,92157,99145,47882,192907,47888,166898,212687,133508,86890,109924,127388,145560,223003,14166,196847,214583,96458,184918,146888,81301,152887,25757,205656,90421,84331,12956,228107,188576,92160,206461,9961,176212,105310,155106,232936,151326,14377,44227,114310,125448,52488,119654,222062,42454,219778,157146,52952,113633,212545,107345,36903,178231,136678,142219,66687,53131,19514,195908,73774,174322,116351,221877,162582,71616,224107,41330,199097,86848,51346,177000,138649,141018,179254,154002,205772,149076,142112,89339,122228,133687,233412,93287,93817,42338,161123,99365,217210,219512,26793,206734,150077,94375,29911,86406,122428,68857,191969,183492,151908,138555,147424,3813,195830,171250,197704,69139,172751,228533,26424,1480,1540,222732,186235,92976,38211,43012,207351,82429,76015,205921,185002,23403,222718,166709,189727,116121,176111,101953,148361,73078,63033,10306,4220,75933,160309,98518,239092,177243,168169,197750,30164,233005,213184,104758,141524,231811,94873,36933,48186,238750,215910,159625,175852,222004,133447,70567,239275,226212,20757,141919,163932,235616,4527,229092,49769,74550,19038,13306,234975,176211,69538,7319,238501,212399,178735,117691,28157,149619,74387,204227,228766,179506,24188,148741,190542,152740,61375,138657,186553,158345,109482,198470,37417,35682,56640,169501,199136,38110,39655,200606,163212,228363,201850,144995,225667,16938,212739,68524,71302,61185,79925,21379,12490,162584,143160,38399,30200,76951,239414,145059,108665,90307,97220,10108,140594,172309,58974,158922,54800,44014,195386,170788,34628,133589,96730,48621,157905,11467,145260,79607,196651,181860,7126,72453,85146,49575,113371,225280,130352,51087,56410,123735,138507,114855,129267,222309,215062,145735,226437,128304,185536,115012,210728,82691,63280,182914,170818,145224,235661,170421,141559,39985,213957,82799,76400,20963,51080,46647,51790,177462,61084,76568,14634,93273,74291,139089,239033,232464,111812,44803,23856,63846,216022,75192,123767,80006,31219,191828,193101,9067,201297,95641,76755,206691,55727,236841,28565,65494,211233,99476,97005,19640,131001,165579,195055,121665,207895,50476,98049,66253,169748,131103,204708,108946,35317,235115,130830,64592,190783,110716,63174,697,147061,13191,212092,25576,228231,52125,129032,238324,137421,9664,140132,9233,123424,82901,115529,175495,205373,73867,132144,144005,185614,17536,187346,129903,112406,116963,216010,127210,34810,146786,42172,238996,112105,178436,10067,117788,129067,46498,15864,55530,168346,32087,199235,210564,232108,130953,133010,79868,148144,11066,239148,14706,21806,126751,219691,173315,190097,116506,231794,208672,171605,142791,73786,122304,205308,155097,151629,24448,64462,112602,149686,64701,239675,96552,178512,81688,39473,187409,217770,37988,7009,218667,120219,219398,39682,203886,62564,78108,237366,38867,167267,177300,41404,199174,194241,120818,229777,8207,239425,57269,49835,29092,147340,127298,54413,157428,33734,158674,87061,210911,131660,156509,127083,63945,147835,27004,54114,49804,123365,138122,59172,22548,199065,145349,134982,114439,167857,106372,123692,44157,16680,127921,201397,63226,176354,131473,205093,164629,142036,17718,200543,75345,62140,71163,142338,232658,72991,79202,147451,7093,95182,20995,233220,203652,114351,148254,95730,132130,124479,41724,95446,79804,24505,178338,114026,73122,193155,15627};

/* omega_n^-1 */
static const uint32_t w_4_inv[3][3]={{228766,240640,11875},
{240640,1,240640},
{11875,240640,228766}};

/* multiplication inverses of omega_256,512,1024 respectively */
static const uint32_t omega_256_inv[128]={1,178338,124479,203652,147451,71163,142036,63226,123692,145349,123365,63945,87061,127298,239425,199174,237366,219398,217770,96552,64462,122304,231794,126751,148144,210564,15864,178436,34810,129903,132144,82901,137421,25576,63174,235115,169748,121665,97005,236841,201297,80006,23856,139089,61084,20963,141559,182914,185536,222309,56410,49575,196651,48621,195386,172309,108665,38399,79925,16938,163212,169501,109482,152740,228766,117691,69538,74550,163932,70567,215910,231811,30164,98518,63033,116121,185002,43012,1540,69139,147424,68857,150077,99365,233412,149076,138649,41330,116351,53131,36903,157146,52488,151326,9961,12956,152887,214583,127388,166898,92157,36689,14092,125133,125819,220059,185098,77949,160115,127810,104901,162557,68996,153036,75794,145402,190280,164025,51772,1048,160808,26570,219370,37126,220755,137590,84573,164358};
static const uint32_t omega_512_inv[512]={1,149774,178338,207176,124479,56271,203652,46616,147451,220222,71163,136631,142036,154182,63226,146933,123692,98223,145349,153702,123365,212889,63945,27271,87061,100988,127298,184863,239425,40053,199174,25111,237366,157149,219398,106220,217770,43481,96552,139635,64462,214668,122304,125735,231794,159409,126751,76425,148144,56692,210564,46922,15864,166143,178436,205927,34810,145675,129903,26431,132144,216411,82901,60697,137421,68124,25576,96386,63174,59197,235115,153916,169748,115302,121665,195267,97005,126495,236841,215406,201297,108552,80006,100049,23856,211617,139089,105798,61084,105478,20963,69235,141559,182361,182914,227432,185536,208748,222309,56842,56410,86471,49575,67995,196651,192320,48621,124353,195386,112677,172309,104762,108665,159598,38399,92567,79925,405,16938,34590,163212,120026,169501,179838,109482,38687,152740,184736,228766,11381,117691,98584,69538,41932,74550,149941,163932,150138,70567,149138,215910,126119,231811,58516,30164,229443,98518,50735,63033,117471,116121,59661,185002,122244,43012,119718,1540,117882,69139,201715,147424,26580,68857,77622,150077,78711,99365,91506,233412,168254,149076,74280,138649,140872,41330,150977,116351,96018,53131,125806,36903,67434,157146,10717,52488,77524,151326,168380,9961,165255,12956,183561,152887,62542,214583,145487,127388,188627,166898,156536,92157,36040,36689,21051,14092,193638,125133,67580,125819,58837,220059,203383,185098,62088,77949,35411,160115,225796,127810,104672,104901,232125,162557,199584,68996,201082,153036,239896,75794,212663,145402,150571,190280,123731,164025,121942,51772,165226,1048,65220,160808,62266,26570,14963,219370,3445,37126,17937,220755,7893,137590,112625,84573,216185,164358,183997,240640,90867,62303,33465,116162,184370,36989,194025,93190,20419,169478,104010,98605,86459,177415,93708,116949,142418,95292,86939,117276,27752,176696,213370,153580,139653,113343,55778,1216,200588,41467,215530,3275,83492,21243,134421,22871,197160,144089,101006,176179,25973,118337,114906,8847,81232,113890,164216,92497,183949,30077,193719,224777,74498,62205,34714,205831,94966,110738,214210,108497,24230,157740,179944,103220,172517,215065,144255,177467,181444,5526,86725,70893,125339,118976,45374,143636,114146,3800,25235,39344,132089,160635,140592,216785,29024,101552,134843,179557,135163,219678,171406,99082,58280,57727,13209,55105,31893,18332,183799,184231,154170,191066,172646,43990,48321,192020,116288,45255,127964,68332,135879,131976,81043,202242,148074,160716,240236,223703,206051,77429,120615,71140,60803,131159,201954,87901,55905,11875,229260,122950,142057,171103,198709,166091,90700,76709,90503,170074,91503,24731,114522,8830,182125,210477,11198,142123,189906,177608,123170,124520,180980,55639,118397,197629,120923,239101,122759,171502,38926,93217,214061,171784,163019,90564,161930,141276,149135,7229,72387,91565,166361,101992,99769,199311,89664,124290,144623,187510,114835,203738,173207,83495,229924,188153,163117,89315,72261,230680,75386,227685,57080,87754,178099,26058,95154,113253,52014,73743,84105,148484,204601,203952,219590,226549,47003,115508,173061,114822,181804,20582,37258,55543,178553,162692,205230,80526,14845,112831,135969,135740,8516,78084,41057,171645,39559,87605,745,164847,27978,95239,90070,50361,116910,76616,118699,188869,75415,239593,175421,79833,178375,214071,225678,21271,237196,203515,222704,19886,232748,103051,128016,156068,24456,76283,56644};
static const uint32_t omega_1024_inv[1024]={1,31344,149774,91628,178338,217124,207176,27159,124479,157243,56271,100335,203652,25122,46616,200393,147451,193739,220222,91924,71163,31643,136631,114828,142036,117884,154182,128046,63226,77109,146933,80494,123692,34897,98223,181399,145349,3644,153702,2668,123365,132972,212889,58527,63945,233832,27271,25392,87061,211685,100988,216799,127298,200732,184863,191874,239425,147615,40053,237776,199174,201034,25111,183114,237366,102107,157149,238268,219398,13055,106220,91445,217770,915,43481,118481,96552,24672,139635,181573,64462,75092,214668,231432,122304,85446,125735,60183,231794,158705,159409,86613,126751,141075,76425,124686,148144,16800,56692,60904,210564,97950,46922,166017,15864,76910,166143,114952,178436,160503,205927,102986,34810,18346,145675,114866,129903,33912,26431,166942,132144,8644,216411,238517,82901,7426,60697,219663,137421,90565,68124,71063,25576,78973,96386,115670,63174,131708,59197,128658,235115,54576,153916,212977,169748,8802,115302,79350,121665,29833,195267,226295,97005,25685,126495,58164,236841,10095,215406,21127,201297,86789,108552,30789,80006,228844,100049,142985,23856,70877,211617,135365,139089,153260,105798,99532,61084,77100,105478,176374,20963,114342,69235,1302,141559,86538,182361,218152,182914,225232,227432,120265,185536,109978,208748,209163,222309,52500,56842,190325,56410,125613,86471,7441,49575,59863,67995,118584,196651,50370,192320,21030,48621,237812,124353,58155,195386,105975,112677,100572,172309,147333,104762,113683,108665,203687,159598,235245,38399,132615,92567,11511,79925,96390,405,180988,16938,50626,34590,101255,163212,170550,120026,154191,169501,207987,179838,67488,109482,63148,38687,15329,152740,170506,184736,61442,228766,61627,11381,96102,117691,120815,98584,186456,69538,113535,41932,176107,74550,71090,149941,31974,163932,117976,150138,190717,70567,120617,149138,130047,215910,176838,126119,64229,231811,210271,58516,200443,30164,222568,229443,105107,98518,42880,50735,82112,63033,43742,117471,203724,116121,1499,59661,233814,185002,217152,122244,129934,43012,97246,119718,125879,1540,141560,117882,91494,69139,120611,201715,193967,147424,69374,26580,24378,68857,185320,77622,103458,150077,203861,78711,66052,99365,120738,91506,204626,233412,98046,168254,105861,149076,111847,74280,30645,138649,78437,140872,210900,41330,77017,150977,17823,116351,232030,96018,131846,53131,102344,125806,119838,36903,166986,67434,101393,157146,144236,10717,219453,52488,161996,77524,160079,151326,128034,168380,204949,9961,106207,165255,195836,12956,131497,183561,50315,152887,205895,62542,54862,214583,214243,145487,238219,127388,134000,188627,15959,166898,196854,156536,35035,92157,155085,36040,68906,36689,197318,21051,225563,14092,123413,193638,182811,125133,201734,67580,105438,125819,46028,58837,154945,220059,36313,203383,16021,185098,97843,62088,22505,77949,5383,35411,86092,160115,76505,225796,98014,127810,125913,104672,180415,104901,138961,232125,186006,162557,94715,199584,57460,68996,210598,201082,85777,153036,63331,239896,231538,75794,79184,212663,194013,145402,221030,150571,46132,190280,89776,123731,54108,164025,145276,121942,49045,51772,99305,165226,8783,1048,121336,65220,10385,160808,140207,62266,66994,26570,192220,14963,231604,219370,97987,3445,172912,37126,178109,17937,79952,220755,194047,7893,19244,137590,93599,112625,155171,84573,195497,216185,133362,164358,235265,183997,240403,240640,209297,90867,149013,62303,23517,33465,213482,116162,83398,184370,140306,36989,215519,194025,40248,93190,46902,20419,148717,169478,208998,104010,125813,98605,122757,86459,112595,177415,163532,93708,160147,116949,205744,142418,59242,95292,236997,86939,237973,117276,107669,27752,182114,176696,6809,213370,215249,153580,28956,139653,23842,113343,39909,55778,48767,1216,93026,200588,2865,41467,39607,215530,57527,3275,138534,83492,2373,21243,227586,134421,149196,22871,239726,197160,122160,144089,215969,101006,59068,176179,165549,25973,9209,118337,155195,114906,180458,8847,81936,81232,154028,113890,99566,164216,115955,92497,223841,183949,179737,30077,142691,193719,74624,224777,163731,74498,125689,62205,80138,34714,137655,205831,222295,94966,125775,110738,206729,214210,73699,108497,231997,24230,2124,157740,233215,179944,20978,103220,150076,172517,169578,215065,161668,144255,124971,177467,108933,181444,111983,5526,186065,86725,27664,70893,231839,125339,161291,118976,210808,45374,14346,143636,214956,114146,182477,3800,230546,25235,219514,39344,153852,132089,209852,160635,11797,140592,97656,216785,169764,29024,105276,101552,87381,134843,141109,179557,163541,135163,64267,219678,126299,171406,239339,99082,154103,58280,22489,57727,15409,13209,120376,55105,130663,31893,31478,18332,188141,183799,50316,184231,115028,154170,233200,191066,180778,172646,122057,43990,190271,48321,219611,192020,2829,116288,182486,45255,134666,127964,140069,68332,93308,135879,126958,131976,36954,81043,5396,202242,108026,148074,229130,160716,144251,240236,59653,223703,190015,206051,139386,77429,70091,120615,86450,71140,32654,60803,173153,131159,177493,201954,225312,87901,70135,55905,179199,11875,179014,229260,144539,122950,119826,142057,54185,171103,127106,198709,64534,166091,169551,90700,208667,76709,122665,90503,49924,170074,120024,91503,110594,24731,63803,114522,176412,8830,30370,182125,40198,210477,18073,11198,135534,142123,197761,189906,158529,177608,196899,123170,36917,124520,239142,180980,6827,55639,23489,118397,110707,197629,143395,120923,114762,239101,99081,122759,149147,171502,120030,38926,46674,93217,171267,214061,216263,171784,55321,163019,137183,90564,36780,161930,174589,141276,119903,149135,36015,7229,142595,72387,134780,91565,128794,166361,209996,101992,162204,99769,29741,199311,163624,89664,222818,124290,8611,144623,108795,187510,138297,114835,120803,203738,73655,173207,139248,83495,96405,229924,21188,188153,78645,163117,80562,89315,112607,72261,35692,230680,134434,75386,44805,227685,109144,57080,190326,87754,34746,178099,185779,26058,26398,95154,2422,113253,106641,52014,224682,73743,43787,84105,205606,148484,85556,204601,171735,203952,43323,219590,15078,226549,117228,47003,57830,115508,38907,173061,135203,114822,194613,181804,85696,20582,204328,37258,224620,55543,142798,178553,218136,162692,235258,205230,154549,80526,164136,14845,142627,112831,114728,135969,60226,135740,101680,8516,54635,78084,145926,41057,183181,171645,30043,39559,154864,87605,177310,745,9103,164847,161457,27978,46628,95239,19611,90070,194509,50361,150865,116910,186533,76616,95365,118699,191596,188869,141336,75415,231858,239593,119305,175421,230256,79833,100434,178375,173647,214071,48421,225678,9037,21271,142654,237196,67729,203515,62532,222704,160689,19886,46594,232748,221397,103051,147042,128016,85470,156068,45144,24456,107279,76283,5376,56644,238};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint32_t *a)
{
uint32_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint32_t *a, uint32_t n, const uint32_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	uint64_t u, v;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			u = a[j1];
			v = a[j1 + d];
			
			a[j1] = barrett_4q(u + v);
			a[j1 + d] = barrett_4q(Q2 + u - v);

			j_omega = num_of_problems;
			
			for (j = j1 + 1; j < j2; j++)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = a[j];
				v = a[j + d];
				
				a[j] = barrett_4q(u + v);
				a[j + d] = barrett_4q2((Q2 + u - v) * omega[j_omega]);
				
				j_omega += num_of_problems;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k++)
	{
		j = k << 2;
		
		u = a[j];
		v = a[j + 2];
			
		a[j] = barrett_4q(u + v);
		a[j + 2] = barrett_4q(Q2 + u - v);
		
		u = a[j + 1];
		v = a[j + 3];

		a[j + 1] = barrett_4q(u + v);
		a[j + 3] = barrett_4q2((Q2 + u - v) * omega[num_of_problems]);
	}
	
	for (k = 0; k < (n >> 1); k++)
	{
		j = k << 1;
		
		u = a[j];
		v = a[j + 1];
		
		a[j] = barrett_4q(u + v);				
		a[j + 1] = barrett_4q(Q2 + u - v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint32_t *a, uint32_t N1, uint32_t N2, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t))
{
	uint32_t n1, n2;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint32_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t), uint32_t inv_n)
{
	uint32_t i, n1, n2;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i++)
	{
		a[i] = barrett_2q2((uint64_t)a[i] * (uint64_t)inv_n);
	}
}

/* 256 * 3 --> 256 * 5 */
static void ntt_butterfly_768_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1]) % Q;
}

/* 256 * 5 --> 256 * 2 */
static void ntt_butterfly_1280_512(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	f = a[N2_1280 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2] + f * w_5[0][3]) % Q;
}

/* 256 * 1 --> 256 * 4 */
static void ntt_butterfly_256_1024(uint32_t *a, uint32_t n2)
{
	a[N2_1024 + n2] = a[n2];
	a[N2_1024 * 2 + n2] = a[n2];
	a[N2_1024 * 3 + n2] = a[n2];
}

/* 256 * 3 --> 256 * 4 */
static void ntt_butterfly_768_1024(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_1024 + n2];
	d = a[N2_1024 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_1024 + n2] = (b + c * w_4[0][0] + d * w_4[0][1]) % Q;
	a[N2_1024 * 2 + n2] = (b + c * w_4[1][0] + d * w_4[1][1]) % Q;
	a[N2_1024 * 3 + n2] = (b + c * w_4[2][0] + d * w_4[2][1]) % Q;
}

/* 256 * 4 --> 256 * 4 */
static void ntt_butterfly_1024_1024_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1024 + n2];
	d = a[N2_1024 * 2 + n2];
	e = a[N2_1024 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1024 + n2] = (b + c * w_4_inv[0][0] + d * w_4_inv[0][1] + e * w_4_inv[0][2]) % Q;
	a[N2_1024 * 2 + n2] = (b + c * w_4_inv[1][0] + d * w_4_inv[1][1] + e * w_4_inv[1][2]) % Q;
	a[N2_1024 * 3 + n2] = (b + c * w_4_inv[2][0] + d * w_4_inv[2][1] + e * w_4_inv[2][2]) % Q;
}

/* 256 * 2 --> 256 * 2 */
static void ntt_butterfly_512_512_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_512 + n2];

	a[n2] = barrett_4q(b + c);
	a[N2_512 + n2] = barrett_4q(Q2 + b - c);
}

/* 256 * 2 --> 256 * 1 */
static void ntt_butterfly_512_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_4q(a[n2] + a[N2_512 + n2]);
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1] + e * w_5[1][2]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1] + e * w_5[2][2]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1] + e * w_5[3][2]) % Q;
}

/* 256 * 5 --> 256 * 1 */
static void ntt_butterfly_1280_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_16q(a[n2] + a[N2_1280 + n2] + a[N2_1280 * 2 + n2] + a[N2_1280 * 3 + n2] + a[N2_1280 * 4 + n2]);	
}

void ntt_768_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_768_1280);
}

void intt_1280_512(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 512, omega_256, omega_1280, ntt_butterfly_1280_512, INV_1280);
}

void ntt_256_1024(uint32_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_256_1024);
}

void ntt_768_1024(uint32_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_768_1024);
}

void intt_1024_1024_inv(uint32_t *a)
{
	intt_core(a, N1_1024, N2_1024, 1024, omega_256_inv, omega_1024_inv, ntt_butterfly_1024_1024_inv, INV_1024);
}

void ntt_512_512_inv(uint32_t *a)
{
	ntt_core(a, N1_512, N2_512, omega_256_inv, omega_512_inv, ntt_butterfly_512_512_inv);
}

void intt_512_256(uint32_t *a)
{
	intt_core(a, N1_512, N2_512, 256, omega_256, omega_512, ntt_butterfly_512_256, INV_512);
}

void ntt_1024_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_256(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 256, omega_256, omega_1280, ntt_butterfly_1280_256, INV_1280);
}
